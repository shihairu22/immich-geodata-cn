# Immich åå‘åœ°ç†ç¼–ç æ±‰åŒ–

è¿™æ˜¯ä¸€ä¸ªä¸º Immich çš„åå‘åœ°ç†ä½ç¼–ç åŠŸèƒ½æä¾›æ±‰åŒ–æ”¯æŒçš„é¡¹ç›®ï¼Œä¸»è¦è§£å†³ Immich è¯†åˆ«ç…§ç‰‡æ‹æ‘„ä½ç½®éƒ½æ˜¯è‹±æ–‡çš„é—®é¢˜ï¼Œå¹¶å¯¹ç»“æœè¿›è¡Œäº†ä¼˜åŒ–

- **åœ°ç‚¹ä¸­æ–‡åŒ–**ï¼šå¯¹å›½å†…çš„åœ°å€ï¼ˆå«æ¸¯æ¾³å°ï¼‰å®ç°äº†å®Œæ•´æ±‰åŒ–ï¼Œå¹¶å®éªŒæ€§æ”¯æŒéƒ¨åˆ†æµ·å¤–åœ°åŒºï¼ˆç›®å‰åŒ…æ‹¬æ—¥æœ¬ï¼‰
- **åœ°å€æ ‡å‡†åŒ–**ï¼šé€šè¿‡é«˜å¾·/Nominatim APIï¼Œå°†åœ°å€ç»Ÿä¸€è§„èŒƒä¸º **ä¸€çº§**ã€**äºŒçº§**ã€**ä¸‰çº§**ã€**å››çº§è¡Œæ”¿åŒº** å››ä¸ªå±‚çº§ï¼Œé¿å… Immich é»˜è®¤ä½¿ç”¨çš„éæ ‡å‡†æˆ–å†·åƒ»åœ°åï¼Œä¸”å…·ä½“ç²’åº¦å¯é€‰ã€‚
- **è‡ªåŠ¨æ›´æ–°**ï¼šä»“åº“ä¼šæ¯å‘¨å®šæœŸæ‹‰å–æœ€æ–°åœ°ç†ä¿¡æ¯æ•°æ®ï¼Œå¹¶è‡ªåŠ¨å‘å¸ƒæ›´æ–°ç‰ˆæœ¬ã€‚

ä»¥ä¸‹æ˜¯ä½¿ç”¨åçš„å‰åå¯¹æ¯”

![](./image/example.png)

# å¦‚ä½•ä½¿ç”¨

### 1. ä¸‹è½½æ•°æ®
åœ¨ [Release é¡µé¢](https://github.com/ZingLix/immich-geodata-cn/releases/latest) ä¸‹è½½ geodata.zip å’Œ i18n-iso-countries.zip ä¸¤ä¸ªæ–‡ä»¶å¹¶è§£å‹

æ•°æ®å‘å¸ƒåˆ†ä¸ºä»¥ä¸‹ä¸¤ç±»ï¼š  
- ğŸ”„ [**è‡ªåŠ¨æ›´æ–°ç‰ˆ**](https://github.com/ZingLix/immich-geodata-cn/releases/tag/auto-release)ï¼šæ›´æ–°æ›´é¢‘ç¹ï¼Œæ¨èä½¿ç”¨ã€‚ä½†ç”±äºæ•°æ®æºå¯èƒ½å‘ç”Ÿå˜åŒ–ï¼Œå¶å°”ä¼šå¯¼è‡´ç”Ÿæˆçš„æ–‡ä»¶ä¸å¯ç”¨ã€‚å¦‚é‡é—®é¢˜å¯åˆ‡æ¢è‡³æ‰‹åŠ¨å‘å¸ƒç‰ˆå¹¶æäº¤ issueã€‚  
- ğŸ› ï¸ [**æ‰‹åŠ¨å‘å¸ƒç‰ˆ**](https://github.com/ZingLix/immich-geodata-cn/releases)ï¼šç›¸å¯¹ç¨³å®šï¼Œé€‚åˆä½œä¸ºå¤‡ç”¨é€‰é¡¹ã€‚

æ–‡ä»¶åä»¥ `_full` ç»“å°¾çš„ç‰ˆæœ¬æ•°æ®é‡æ›´å¤§ï¼Œåœ¨è¾¹ç•Œä½ç½®è¯†åˆ«ä¸Šè¡¨ç°æ›´å¥½ï¼Œä½†å¯èƒ½ä¼šé™ä½è¯†åˆ«é€Ÿåº¦ã€‚  

<details>

<summary>`geodata` æ–‡ä»¶çš„ä¸åŒåç¼€ä»£è¡¨æ”¯æŒçš„è¡Œæ”¿åŒºåˆ’ç²¾åº¦ï¼ˆå¦‚ä¸‰çº§ã€å››çº§ï¼‰ï¼Œç‚¹å‡»æŸ¥çœ‹ç¤ºä¾‹æˆ–å‚è€ƒ Release é¡µé¢</summary>

ä»¥ `ä¸­å›½,æ±Ÿè‹çœ,è‹å·å¸‚,æ˜†å±±å¸‚,å‘¨å¸‚é•‡` ä¸ºä¾‹

|ç¤ºä¾‹|å¯¹åº”æ–‡ä»¶|æ•°æ®å¢å¼º<br>æ•°æ®æ›´å¤šã€å®šä½æ›´å‡†ä½†ç¼–ç æ›´æ…¢|
|:---|:---|:---|
|è‹å·å¸‚|geodata.zip<br>geodata_admin_2.zip|geodata_full.zip<br>geodata_admin_2_full.zip|
|æ˜†å±±å¸‚|geodata_admin_3.zip|geodata_admin_3_full.zip|
|å‘¨å¸‚é•‡|geodata_admin_4.zip|geodata_admin_4_full.zip|
|è‹å·å¸‚ æ˜†å±±å¸‚|geodata_admin_2_admin_3.zip|geodata_admin_2_admin_3_full.zip|
|è‹å·å¸‚ å‘¨å¸‚é•‡|geodata_admin_2_admin_4.zip|geodata_admin_2_admin_4_full.zip|
|æ˜†å±±å¸‚ å‘¨å¸‚é•‡|geodata_admin_3_admin_4.zip|geodata_admin_3_admin_4_full.zip|
|è‹å·å¸‚ æ˜†å±±å¸‚ å‘¨å¸‚é•‡|geodata_admin_2_admin_3_admin_4.zip|geodata_admin_2_admin_3_admin_4_full.zip|

</details>

### 2. é…ç½® Docker å®¹å™¨æ˜ å°„

ä¿®æ”¹ä½ çš„ docker-compose.yamlï¼Œåœ¨ volumes ä¸­æ·»åŠ ä»¥ä¸‹æŒ‚è½½ï¼ˆæˆ–æŒ‰ä½ çš„éƒ¨ç½²æ–¹å¼æ›¿æ¢ç›®æ ‡æ–‡ä»¶å¤¹ï¼‰ï¼š

å¦‚æœä½¿ç”¨çš„æ˜¯å®˜æ–¹ `immich-app/immich-server` é•œåƒï¼Œä¿®æ”¹è·¯å¾„å¦‚ä¸‹

```yaml
# immich ç‰ˆæœ¬ >= 1.136.0
volumes:
  - ./geodata:/build/geodata
  - ./i18n-iso-countries/langs:/usr/src/app/server/node_modules/i18n-iso-countries/langs

# immich ç‰ˆæœ¬ < 1.136.0 (ä¸å«)
volumes:
  - ./geodata:/build/geodata
  - ./i18n-iso-countries/langs:/usr/src/app/node_modules/i18n-iso-countries/langs
```

å¦‚æœä½¿ç”¨çš„æ˜¯ `imagegenius/immich` é•œåƒï¼Œä¿®æ”¹è·¯å¾„å¦‚ä¸‹ï¼ˆæ„Ÿè°¢ huazhaozhe [#18](https://github.com/ZingLix/immich-geodata-cn/discussions/18)ï¼‰

```
volumes:
  - ./geodata:/app/immich/server/geodata
  - ./i18n-iso-countries/langs:/app/immich/server/node_modules/i18n-iso-countries/langs
```

### 3. é‡å¯ Immich

è¿è¡Œ `docker compose down && docker compose up` é‡å¯ Immich
  - å¯åŠ¨æ—¥å¿—ä¸­è‹¥å‡ºç°ç±»ä¼¼ 10000 geodata records importedï¼Œè¯´æ˜ geodata å·²æˆåŠŸæ›´æ–°ã€‚
  - è‹¥æ— æ­¤æ—¥å¿—ï¼Œå¯å°è¯•ä¿®æ”¹ geodata/geodata-date.txt ä¸­çš„æ—¥æœŸä¸ºå½“å‰æ—¶é—´ï¼ŒImmich åªä¼šåœ¨æ–‡ä»¶æ—¥æœŸæ–°äºä¸Šæ¬¡åŠ è½½æ—¶æ›´æ–°æ•°æ®ã€‚
    ![](./image/importlog.jpg)

### 4. åˆ·æ–°å…ƒæ•°æ®

> **æ³¨æ„**ï¼šä»…åœ¨é¦–æ¬¡ä½¿ç”¨æœ¬é¡¹ç›®æä¾›çš„åœ°ç†æ•°æ®æ—¶éœ€è¦æ‰§è¡Œæ­¤æ­¥éª¤ï¼Œç”¨äºæ›´æ–°æ‰€æœ‰å·²æœ‰ç…§ç‰‡çš„ä½ç½®ã€‚  
> åç»­æ–°å¢ç…§ç‰‡æ— éœ€é‡å¤æ­¤æ“ä½œã€‚

è¿›å…¥ã€Œç³»ç»Ÿç®¡ç† - ä»»åŠ¡ã€é¡µé¢ï¼Œç‚¹å‡»ã€Œæå–å…ƒæ•°æ®ã€ä¸­çš„ã€Œå…¨éƒ¨ã€ï¼Œè§¦å‘å¯¹æ‰€æœ‰ç…§ç‰‡ä½ç½®ä¿¡æ¯çš„åˆ·æ–°ã€‚ä»»åŠ¡å®Œæˆåï¼Œæ‰€æœ‰ç…§ç‰‡çš„ä½ç½®å°†æ˜¾ç¤ºä¸ºä¸­æ–‡åœ°åå¹¶æ”¯æŒä¸­æ–‡æœç´¢ã€‚

# å¦‚ä½•æ›´æ–°

é‡æ–°ä¸‹è½½æœ€æ–° Release é¡µé¢ä¸­çš„æ–‡ä»¶ï¼Œæ›¿æ¢æ‰åŸæœ‰æ–‡ä»¶ï¼Œç„¶åé‡å¯ Immich å³å¯å®Œæˆæ›´æ–°ã€‚

ä¸ºäº†æ–¹ä¾¿å¿«é€Ÿæ›´æ–°ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è„šæœ¬è‡ªåŠ¨ä¸‹è½½å¹¶æ›¿æ¢æ–‡ä»¶ï¼š

```bash
# cd geodata  åœ¨ geodata ç›®å½•ä¸‹è¿›è¡Œæ“ä½œ

# ä¸‹è½½è„šæœ¬
curl -o update.sh https://raw.githubusercontent.com/ZingLix/immich-geodata-cn/refs/heads/main/geodata/update.sh

# è¿è¡Œæ›´æ–°è„šæœ¬ï¼Œå‚æ•°ä¸ºä½ éœ€è¦çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚ geodata_admin_2
bash update.sh geodata_admin_2
```

æ›´æ–°å®Œæˆåï¼Œéœ€è¦é‡å¯ Immich ä»¥é‡æ–°åŠ è½½æ•°æ®ã€‚å¦‚æœå¸Œæœ›è‡ªåŠ¨é‡å¯ï¼Œå¯ä»¥åœ¨è„šæœ¬æœ€åå¢åŠ ç±»ä¼¼ `docker restart immich_server` çš„å‘½ä»¤è¿›è¡Œé‡å¯ï¼Œæˆ–è€…é€šè¿‡ç±»ä¼¼å¦‚ä¸‹å®šæ—¶ä»»åŠ¡çš„æ–¹å¼ä¸€èµ·è¿è¡Œé‡å¯ã€‚

```bash
5 5 * * 6 bash /immich_data/geodata/update.sh && docker restart immich_server
```

# å¦‚ä½•ç”Ÿæˆæ•°æ®

å…³äºå¦‚ä½•è¿ä½œçš„ï¼Œæˆ–è€…æ˜¯æƒ³è¦è‡ªå®šä¹‰æ•°æ®çš„ï¼Œå¯ä»¥åˆ° [æ­¤å¤„](https://github.com/ZingLix/immich-geodata-cn/tree/main/geodata) æŸ¥çœ‹ã€‚

# License

GPL

# ğŸ’– æ”¯æŒæˆ‘

æœ¬é¡¹ç›®æ‰¿è¯ºå°† **æ°¸ä¹…å…è´¹å¼€æ”¾ä½¿ç”¨**ï¼Œå¦‚æœä½ è§‰å¾—å®ƒå¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿è¯·æˆ‘å–æ¯å’–å•¡ â˜•ï¼Œè®©è¿™ä¸ªé¡¹ç›®å¯ä»¥æŒç»­ç»´æŠ¤ä¸‹å»å¹¶å¢åŠ æ›´å¤šåŠŸèƒ½ï¼

<img src="image/sponsor.jpg" alt="èµåŠ©" width="400" />
